<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>OneX Smart Gold â€“ Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body { background:#0b0f19; color:#fff; font-family:Arial; text-align:center; }
    .box { background:#131a2a; padding:20px; margin:15px auto; max-width:420px; border-radius:12px; }
    button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:8px; background:#f5c542; font-size:16px; }
    input { width:100%; padding:10px; margin-top:10px; border-radius:6px; }
    .small { font-size:13px; opacity:0.8; }
  </style>
</head>

<body>

<h2>OneX Smart Gold (OSG)</h2>
<p class="small">Stake â€¢ Earn â€¢ Grow</p>

<div class="box">
  <button onclick="connectWallet()">ðŸ”Œ Connect Wallet</button>
  <p id="wallet"></p>
  <p id="balance"></p>
</div>

<div class="box">
  <h3>ðŸ“¥ Stake OSG</h3>
  <input id="stakeAmount" placeholder="Enter OSG amount" />
  <button onclick="approveAndStake()">Approve & Stake</button>

  <h3 style="margin-top:15px;">ðŸ“¤ Unstake</h3>
  <button onclick="unstake()">Unstake</button>
</div>

<script>
/* ================= CONFIG ================= */

const OSG_TOKEN = "0x25c49541763b9Aa482a28E41b5a150CDa2E49a82";
const STAKING_CONTRACT = "0xa1D71A7459D757e6471ec7573867";

/* ================= GLOBAL ================= */

let provider, signer, user;

/* ================= CONNECT ================= */

async function connectWallet() {
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();

  document.getElementById("wallet").innerText =
    "Connected: " + user.slice(0,6) + "..." + user.slice(-4);

  getBalance();
}

/* ================= BALANCE ================= */

async function getBalance() {
  const abi = [
    "function balanceOf(address) view returns(uint256)",
    "function decimals() view returns(uint8)"
  ];
  const token = new ethers.Contract(OSG_TOKEN, abi, provider);
  const bal = await token.balanceOf(user);
  const dec = await token.decimals();
  document.getElementById("balance").innerText =
    "OSG Balance: " + ethers.utils.formatUnits(bal, dec);
}

/* ================= APPROVE + STAKE ================= */

async function approveAndStake() {
  const amount = document.getElementById("stakeAmount").value;
  if (!amount || amount <= 0) return alert("Enter valid amount");

  const tokenAbi = [
    "function approve(address spender, uint256 amount) returns(bool)",
    "function decimals() view returns(uint8)"
  ];

  const stakingAbi = [
    "function stake(uint256 amount)"
  ];

  const token = new ethers.Contract(OSG_TOKEN, tokenAbi, signer);
  const staking = new ethers.Contract(STAKING_CONTRACT, stakingAbi, signer);

  const decimals = await token.decimals();
  const parsed = ethers.utils.parseUnits(amount, decimals);

  /* 1ï¸âƒ£ Approve */
  const tx1 = await token.approve(STAKING_CONTRACT, parsed);
  await tx1.wait();

  /* 2ï¸âƒ£ Stake */
  const tx2 = await staking.stake(parsed);
  await tx2.wait();

  alert("âœ… Stake successful");
  getBalance();
}

/* ================= UNSTAKE ================= */

async function unstake() {
  const abi = ["function unstake()"];
  const staking = new ethers.Contract(STAKING_CONTRACT, abi, signer);

  const tx = await staking.unstake();
  await tx.wait();

  alert("âœ… Unstake successful");
  getBalance();
}
</script>

</body>
</html>
